#!/usr/bin/env bash

# Prepend stuff to PATH
export PATH="$(
sort -u << EOF | tr '\n' ':'
$HOME/bin
/bin
/sbin
/usr/bin
/usr/lib/mit/sbin
/usr/local/bin
/usr/local/sbin
/usr/sbin
$(tr ':' '\n' <<< "$PATH")
EOF
)"

# History settings
HISTCONTROL=ignoredups:ignorespace
HISTSIZE=1000
HISTFILESIZE=2000
HISTTIMEFORMAT="%d/%m/%y %T "

# Start SSH agent
SSH_ENV="$HOME/.ssh/environment"
start_agent () {
  echo "Initialising new SSH agent..."
  ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
  echo succeeded
  chmod 600 "${SSH_ENV}"
  source "${SSH_ENV}" > /dev/null
  ssh-add
}
if [ -f "${SSH_ENV}" ]; then
  source "${SSH_ENV}" > /dev/null
  ps -ef | grep ${SSH_AGENT_PID} | grep 'ssh-agent$' > /dev/null || { start_agent; }
elif [[ $- == *i* ]] ; then
  start_agent;
fi

# Enable Bash completion
source "$PWD/bash-completion/bash_completion"

# Set a cooler prompt for git and stuff
source "$PWD/bash-git-prompt/gitprompt.sh"
export GIT_PROMPT_ONLY_IN_REPO=0
export GIT_PROMPT_THEME="Single_line_Minimalist"

# Source bblib and remove unwanted traps
source "$PWD/bblib/bblib.bash"
trap - INT TERM QUIT HUP EXIT ERR

# Source my settings
source aliases
source colors
source functions
source options
source get_binaries

# Source extra Mac stuff if on a Mac
[[ "$(uname)" == 'Darwin' ]] && source "$PWD/osx"

if [ -d "$HOME/.pyenv" ] && which pyenv 2>&1 > /dev/null ; then
  eval "$(pyenv init -)"
else
logger -s <<< "ERROR pyenv is not installed."
#  get__pyenv
#  eval "$(pyenv init -)"
fi
